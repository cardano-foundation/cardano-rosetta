name: CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
      - name: Use Node.js
        uses: actions/setup-node@v1
        with:
          node-version: 14
      - run: yarn --cwd ./cardano-rosetta-server install --offline --frozen-lockfile --logevel=error
      - run: yarn --cwd ./cardano-rosetta-server lint
      - run: yarn --cwd ./cardano-rosetta-server test
        env:
          PORT: 8080
          LOGGER_LEVEL: debug
          LOGGER_ENABLED: true
          BIND_ADDRESS: 127.0.0.1
          DB_CONNECTION_STRING: postgresql://postgres:notForProduction!@127.0.0.1:5432/cexplorer
          TOPOLOGY_FILE_PATH: test/e2e/utils/topology-test.json
          CARDANOCLI_PATH: cardano-cli
          CARDANO_NODE_PATH: cardano-node
          GENESIS_PATH: test/e2e/utils/mainnet-genesis.json
          CARDANO_NODE_SOCKET_PATH: /tmp/ipc/node.socket
          PAGE_SIZE: 5
          DEFAULT_RELATIVE_TTL: 1000
#      - name: Build Dev Docker images
#        run: ./scripts/build_dev_docker_images.sh
#  docker-build:
#    runs-on: ubuntu-latest
#    steps:
#      - name: Checkout source code
#        uses: actions/checkout@v2
#
#      - name: Build Docker images
#        uses: docker/build-push-action@v1
#        with:
#          username: ${{ secrets.DOCKER_USERNAME }}
#          password: ${{ secrets.DOCKER_PASSWORD }}
#          repository: inputoutput/cardano-rosetta
#          tag_with_ref: true
#          tag_with_sha: true
#          push: false
